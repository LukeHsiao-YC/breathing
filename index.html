<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ¨‚å‘¼å¸å°æ°£çƒ - å…’ç«¥è…¹å¼å‘¼å¸å¼•å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap');

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #E0F2FE; /* Sky blue */
            background-image: radial-gradient(#bae6fd 1px, transparent 1px);
            background-size: 20px 20px;
            overflow: hidden; /* é˜²æ­¢æ‰‹æ©Ÿä¸Šä¸‹æ»‘å‹• */
        }

        /* æ°£çƒå‹•ç•«èˆ‡æ¨£å¼ */
        .balloon-container {
            position: relative;
            width: 200px;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            /* ç§»é™¤ transitionï¼Œç”± JS æ§åˆ¶ */
        }

        .balloon {
            width: 150px;
            height: 150px;
            background: radial-gradient(circle at 30% 30%, #FF9AA2, #FF6F91);
            border-radius: 50%;
            box-shadow: 0 10px 25px rgba(255, 111, 145, 0.4);
            position: relative;
            /* é è¨­éæ¸¡æ•ˆæœï¼ŒJS æœƒåœ¨é‹è¡Œæ™‚è¦†è“‹æ­¤å±¬æ€§ä»¥åŒ¹é…ç§’æ•¸ */
            transition: transform 0.5s ease; 
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            will-change: transform; /* å„ªåŒ–æ¸²æŸ“æ•ˆèƒ½ */
        }

        /* æ°£çƒçš„è‡‰éƒ¨è¡¨æƒ… */
        .face {
            position: relative;
            width: 60%;
            top: -10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .eye {
            width: 15px;
            height: 15px;
            background-color: #333;
            border-radius: 50%;
            animation: blink 3s infinite;
        }

        .mouth {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 10px;
            border-bottom: 3px solid #333;
            border-radius: 0 0 15px 15px;
            transition: all 0.3s ease;
        }

        /* è…®ç´… */
        .cheek {
            position: absolute;
            top: 20px;
            width: 20px;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
        }
        .cheek.left { left: -5px; }
        .cheek.right { right: -5px; }

        /* è¡¨æƒ…è®ŠåŒ– */
        .balloon.inhale .mouth {
            width: 30px;
            height: 30px;
            background-color: #333;
            border-radius: 50%;
            border: none;
        }

        .balloon.hold .eye {
            height: 2px; /* é–‰çœ¼äº«å— */
            margin-top: 7px;
            animation: none; /* é–‰çœ¼æ™‚ä¸çœ¨çœ¼ */
        }

        .balloon.exhale .mouth {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #333;
            border: none;
        }

        @keyframes blink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }

        /* ç²’å­å‹•ç•« */
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            z-index: 50;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }

        /* æ³¢ç´‹å‹•ç•« */
        @keyframes ripple-effect {
            0% { transform: scale(1); opacity: 0.6; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        .animate-ripple {
            animation: ripple-effect 1s infinite;
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-4">

    <!-- ä¸»å¡ç‰‡ -->
    <div class="bg-white/90 backdrop-blur-md rounded-3xl shadow-2xl p-6 md:p-8 max-w-md w-full text-center border-4 border-white relative overflow-hidden">
        
        <!-- é ‚éƒ¨æ¨™é¡Œèˆ‡è£é£¾ -->
        <div class="mb-6 relative z-10">
            <h1 class="text-3xl font-bold text-gray-800 tracking-wider mb-2">å¿«æ¨‚å‘¼å¸å°æ°£çƒ</h1>
            <p class="text-gray-500 text-sm">è·Ÿè‘—æ°£çƒä¸€èµ·è®“è‚šå­è®Šå¤§ã€è®Šå°</p>
        </div>

        <!-- é€²åº¦æŒ‡ç¤ºå™¨ (ä¸‰å€‹éšæ®µ) -->
        <div class="flex justify-center gap-3 mb-8">
            <div id="step-dot-1" class="w-3 h-3 rounded-full bg-gray-300 transition-all duration-300"></div>
            <div id="step-dot-2" class="w-3 h-3 rounded-full bg-gray-300 transition-all duration-300"></div>
            <div id="step-dot-3" class="w-3 h-3 rounded-full bg-gray-300 transition-all duration-300"></div>
        </div>

        <!-- æ ¸å¿ƒå‹•ç•«å€ -->
        <div class="h-64 flex justify-center items-center relative mb-6">
            <!-- è£é£¾åœˆåœˆ (èƒŒæ™¯) - ç”¨æ–¼å¸æ°£æ™‚çš„æ“´æ•£æ•ˆæœ -->
            <div id="ripple" class="absolute w-40 h-40 border-4 border-pink-200 rounded-full opacity-0"></div>
            
            <div class="balloon-container">
                <div id="balloon" class="balloon">
                    <div class="face">
                        <div class="cheek left"></div>
                        <div class="eye left"></div>
                        <div class="mouth"></div>
                        <div class="eye right"></div>
                        <div class="cheek right"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æŒ‡ä»¤æ–‡å­—èˆ‡å€’æ•¸ -->
        <div class="h-28 mb-4 relative z-10 flex flex-col justify-center items-center">
            <h2 id="instruction-text" class="text-2xl font-bold text-pink-500 mb-1 transition-all">æº–å‚™å¥½äº†å—ï¼Ÿ</h2>
            <p id="sub-instruction" class="text-gray-500 text-sm mb-2 h-5">æŠŠæ‰‹æ”¾åœ¨è‚šå­ä¸Šï¼Œæ„Ÿè¦ºè‚šå­çš„èµ·ä¼</p>
            <div id="timer-display" class="text-6xl font-black text-gray-700 opacity-0 transition-opacity" style="font-variant-numeric: tabular-nums;">0</div>
        </div>

        <!-- æ§åˆ¶æŒ‰éˆ• -->
        <div class="flex gap-4 justify-center relative z-10 w-full mt-2">
            <button id="start-btn" onclick="startExercise()" class="bg-gradient-to-r from-pink-400 to-rose-400 hover:from-pink-500 hover:to-rose-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-105 active:scale-95 text-lg w-full max-w-xs flex justify-center items-center">
                <i class="fas fa-play mr-2"></i> é–‹å§‹ç·´ç¿’
            </button>
            <button id="stop-btn" onclick="stopExercise()" class="hidden bg-gray-200 hover:bg-gray-300 text-gray-600 font-bold py-3 px-6 rounded-full shadow-md transform transition hover:scale-105 active:scale-95 w-full max-w-xs flex justify-center items-center">
                <i class="fas fa-stop mr-2"></i> åœæ­¢
            </button>
        </div>

        <!-- å®Œæˆæ¬¡æ•¸ -->
        <div class="mt-6 text-sm text-gray-400">
            å·²å®Œæˆå‘¼å¸æ¬¡æ•¸: <span id="cycle-count" class="font-bold text-pink-500 text-lg">0</span>
        </div>
    </div>

    <script>
        // === å‘¼å¸ç¯€å¥è¨­å®š (ç§’) ===
        const CONFIG = {
            inhale: 4,  // å¸æ°£
            hold: 2,    // æ†‹æ°£
            exhale: 7   // åæ°£ (æ‚¨æŒ‡å®šç‚º 7 ç§’)
        };

        // ç‹€æ…‹è®Šæ•¸
        let isRunning = false;
        let timerInterval = null;
        let cycleCount = 0;
        
        // DOM å…ƒç´ å¿«å–
        const balloon = document.getElementById('balloon');
        const instructionText = document.getElementById('instruction-text');
        const subInstruction = document.getElementById('sub-instruction');
        const timerDisplay = document.getElementById('timer-display');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const cycleCountDisplay = document.getElementById('cycle-count');
        const ripple = document.getElementById('ripple');
        const dots = [
            document.getElementById('step-dot-1'),
            document.getElementById('step-dot-2'),
            document.getElementById('step-dot-3')
        ];

        // é‡ç½®ä»‹é¢åˆ°åˆå§‹ç‹€æ…‹
        function resetUI() {
            clearInterval(timerInterval);
            isRunning = false;
            
            // é‡ç½®æ°£çƒæ¨£å¼
            balloon.style.transition = 'transform 0.5s ease-out'; // å›å¾©é è¨­é€Ÿåº¦
            balloon.style.transform = 'scale(1)';
            balloon.classList.remove('inhale', 'hold', 'exhale');
            
            // é‡ç½®æ–‡å­—
            instructionText.textContent = "æº–å‚™å¥½äº†å—ï¼Ÿ";
            instructionText.className = "text-2xl font-bold text-gray-700 mb-1";
            subInstruction.textContent = "æŠŠæ‰‹æ”¾åœ¨è‚šå­ä¸Šï¼Œæ„Ÿè¦ºè‚šå­çš„èµ·ä¼";
            
            // éš±è—å€’æ•¸
            timerDisplay.classList.add('opacity-0');
            timerDisplay.textContent = "0";
            
            // æŒ‰éˆ•åˆ‡æ›
            startBtn.classList.remove('hidden');
            stopBtn.classList.add('hidden');
            
            // é‡ç½®é€²åº¦é»
            dots.forEach(dot => {
                dot.className = "w-3 h-3 rounded-full bg-gray-300 transition-all duration-300";
            });
            
            // åœæ­¢æ³¢ç´‹
            ripple.style.animation = 'none';
            ripple.style.opacity = '0';
        }

        function startExercise() {
            if (isRunning) return;
            isRunning = true;
            
            startBtn.classList.add('hidden');
            stopBtn.classList.remove('hidden');
            timerDisplay.classList.remove('opacity-0');
            
            runCycle();
        }

        function stopExercise() {
            resetUI();
        }

        // åŸ·è¡Œä¸€å€‹å®Œæ•´çš„å‘¼å¸å¾ªç’°
        async function runCycle() {
            if (!isRunning) return;

            // 1. å¸æ°£ (Inhale) - 4ç§’
            // æ°£çƒè®Šå¤§ï¼Œè—è‰²ä¸»é¡Œ
            await runPhase('inhale', CONFIG.inhale, 
                "é¼»å­æ…¢æ…¢å¸æ°£...", 
                "æ„Ÿè¦ºè‚šå­åƒæ°£çƒä¸€æ¨£è®Šå¤§ğŸˆ", 
                "text-sky-500", // Tailwind é¡è‰²
                0 // ç¬¬ä¸€å€‹é»é»
            );
            
            if (!isRunning) return;

            // 2. æ†‹æ°£ (Hold) - 2ç§’
            // æ°£çƒä¿æŒå¤§ï¼Œç´«è‰²ä¸»é¡Œ
            await runPhase('hold', CONFIG.hold, 
                "åœä½ä¸€ä¸‹...", 
                "ä¿æŒæ°£çƒé£½é£½çš„", 
                "text-purple-500", 
                1 // ç¬¬äºŒå€‹é»é»
            );
            
            if (!isRunning) return;

            // 3. åæ°£ (Exhale) - 7ç§’
            // æ°£çƒè®Šå°ï¼Œç¶ è‰²ä¸»é¡Œ
            await runPhase('exhale', CONFIG.exhale, 
                "å˜´å·´æ…¢æ…¢åæ°£...", 
                "è‚šå­åƒæ¶ˆæ°£ä¸€æ¨£æ‰ä¸‹å»ğŸ’¨", 
                "text-emerald-500", 
                2 // ç¬¬ä¸‰å€‹é»é»
            );
            
            if (!isRunning) return;

            // å¾ªç’°å®Œæˆï¼Œæ›´æ–°è¨ˆæ•¸ä¸¦æ”¾ç…™ç«
            cycleCount++;
            cycleCountDisplay.textContent = cycleCount;
            createConfetti();
            
            // ç«‹å³é–‹å§‹ä¸‹ä¸€æ¬¡å¾ªç’°
            runCycle();
        }

        // è™•ç†å–®ä¸€éšæ®µçš„é‚è¼¯ (Promise åŒ…è£ä»¥æ”¯æ´ async/await)
        function runPhase(phase, duration, mainText, subText, colorClass, dotIndex) {
            return new Promise(resolve => {
                let timeLeft = duration;

                // 1. æ›´æ–°ä»‹é¢æ–‡å­—èˆ‡é¡è‰²
                instructionText.textContent = mainText;
                instructionText.className = `text-3xl font-bold mb-1 transition-colors duration-300 ${colorClass}`;
                
                subInstruction.textContent = subText;
                
                timerDisplay.textContent = timeLeft;
                timerDisplay.className = `text-6xl font-black transition-colors duration-300 ${colorClass}`;

                // 2. æ›´æ–°é€²åº¦é»é» (ç•¶å‰éšæ®µè®Šå¤§ä¸”è®Šè‰²)
                dots.forEach((dot, idx) => {
                    const bgClass = colorClass.replace('text-', 'bg-'); // å°‡æ–‡å­—é¡è‰²è½‰ç‚ºèƒŒæ™¯è‰²
                    const ringClass = colorClass.replace('text-', 'ring-');
                    
                    if (idx === dotIndex) {
                        dot.className = `w-4 h-4 rounded-full ${bgClass} ring-2 ring-offset-2 ${ringClass} transition-all duration-300`;
                    } else {
                        dot.className = "w-3 h-3 rounded-full bg-gray-200 transition-all duration-300";
                    }
                });

                // 3. è¨­å®šæ°£çƒå‹•ç•«
                // é—œéµï¼šå°‡ CSS transition æ™‚é–“è¨­å®šç‚ºèˆ‡ JS éšæ®µæ™‚é–“å®Œå…¨ä¸€è‡´
                balloon.style.transition = `transform ${duration}s linear`;
                
                // ç§»é™¤èˆŠç‹€æ…‹ï¼ŒåŠ å…¥æ–°ç‹€æ…‹ Class
                balloon.classList.remove('inhale', 'hold', 'exhale');
                balloon.classList.add(phase);

                // æ ¹æ“šéšæ®µè¨­å®šæ°£çƒå¤§å°èˆ‡ç‰¹æ•ˆ
                if (phase === 'inhale') {
                    balloon.style.transform = 'scale(1.6)'; // è®Šå¤§
                    // åªæœ‰å¸æ°£æ™‚æœ‰æ³¢ç´‹æ•ˆæœ
                    ripple.style.animation = `ping ${duration}s cubic-bezier(0, 0, 0.2, 1) infinite`; 
                    ripple.style.opacity = '0.5';
                } else if (phase === 'hold') {
                    balloon.style.transform = 'scale(1.6)'; // ä¿æŒå¤§
                    ripple.style.animation = 'none';
                    ripple.style.opacity = '0';
                } else if (phase === 'exhale') {
                    balloon.style.transform = 'scale(1)'; // è®Šå›åŸç‹€
                    ripple.style.animation = 'none';
                    ripple.style.opacity = '0';
                }

                // 4. é–‹å§‹å€’æ•¸è¨ˆæ™‚å™¨
                timerInterval = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;

                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        resolve(); // éšæ®µçµæŸ
                    }
                }, 1000); // æ¯ç§’åŸ·è¡Œä¸€æ¬¡
            });
        }

        // æ”¾ç…™ç«/ç´™èŠ±ç‰¹æ•ˆ (ç´” CSS/JS å¯¦ç¾ï¼Œä¸éœ€é¡å¤–åœ–ç‰‡)
        function createConfetti() {
            const container = document.body;
            const colors = ['#FF9AA2', '#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7', '#C7CEEA'];
            
            for(let i=0; i<15; i++) {
                const conf = document.createElement('div');
                conf.classList.add('particle');
                
                // éš¨æ©Ÿä½ç½®
                const left = 50 + (Math.random() * 40 - 20); // ä¸­é–“å€åŸŸ
                
                conf.style.left = left + '%';
                conf.style.top = '60%';
                
                // éš¨æ©Ÿå¤§å°èˆ‡é¡è‰²
                const size = (Math.random() * 8 + 6) + 'px';
                conf.style.width = size;
                conf.style.height = size;
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // éš¨æ©Ÿå‹•ç•«åƒæ•¸
                const duration = 1 + Math.random() * 1.5;
                conf.style.animation = `floatUp ${duration}s ease-out forwards`;
                
                container.appendChild(conf);
                
                // å‹•ç•«çµæŸå¾Œç§»é™¤å…ƒç´ 
                setTimeout(() => conf.remove(), duration * 1000);
            }
        }

        // åˆå§‹åŒ–
        resetUI();

    </script>
</body>
</html>